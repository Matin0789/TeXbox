#!/bin/bash

COMMAND="$1"
PROJECT_NAME="$2"

if [ "$COMMAND" = "init" ]; then
    if [ -z "$PROJECT_NAME" ]; then
        ENV_DIR="$(pwd)/.texbox"
    else
        ENV_DIR="$(pwd)/$PROJECT_NAME/.texbox"
        mkdir -p "$(pwd)/$PROJECT_NAME"
    fi

    mkdir -p "$ENV_DIR/texmf" "$ENV_DIR/var" "$ENV_DIR/tlpkg"

    cat > "$ENV_DIR/activate" << EOF
deactivate() {
    unset TEXMFHOME
    unset TEXMFVAR
    unset TLUSRHOME
    echo "TeXbox environment deactivated"
}
if [ -n "$BASH_VERSION" ]; then
    export -f deactivate
fi

export TEXMFHOME="$ENV_DIR/texmf"
export TEXMFVAR="$ENV_DIR/var"
export TLUSRHOME="$ENV_DIR"
export PATH="/usr/local/texlive/2025/bin/x86_64-linux:$PATH"
echo "TeXbox environment activated for project at $ENV_DIR"
EOF

    echo "TeXbox environment initialized at $ENV_DIR"
fi
